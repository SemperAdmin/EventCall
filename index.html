<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Reduce referrer leakage to external sites -->
    <meta name="referrer" content="no-referrer">
    <!-- Strengthen CSP by upgrading insecure requests and allowing workers safely -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://www.google.com https://www.gstatic.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https: https://www.google.com https://www.gstatic.com https://dns.google; worker-src 'self' blob:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; upgrade-insecure-requests">
    <title>EventCall - Where Every Event Matters</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/invite.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/accessibility.css">
    <link rel="stylesheet" href="styles/login.css">
    <link rel="stylesheet" href="styles/dashboard-v2.css">
    <link rel="stylesheet" href="styles/event-management-v2.css">
    <link rel="stylesheet" href="styles/seating-chart.css">
    <!-- Scripts -->
    <!-- CSV Parser -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js" crossorigin="anonymous"></script>
</head>
<body>
<!-- Skip to main content link for keyboard users and screen readers -->
<a href="#main-content" class="skip-to-main">Skip to main content</a>
<!-- Updated Login Page HTML with Obfuscated Token -->

<!-- ============================================
     USERNAME/PASSWORD LOGIN PAGE
     ============================================ -->
<div id="login-page">
    <div class="login-container" style="width: 100%; max-width: 550px; min-height: max-content; height: auto; margin: 2rem auto; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border-radius: 1.5rem; padding: 3rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4); border: 2px solid #3a4556;">

        <!-- Header -->
        <div class="login-header" style="text-align: center; margin-bottom: 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ–ï¸</div>
            <h2 style="color: #d4af37; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Welcome to EventCall</h2>
            <p class="login-subtitle" style="color: #94a3b8; font-size: 1rem;">Secure event management for military professionals</p>
        </div>

        <!-- Tab Switcher -->
        <div class="auth-tabs" style="display: flex; gap: 0.5rem; margin-bottom: 2rem; background: rgba(0, 0, 0, 0.2); padding: 0.25rem; border-radius: 0.5rem;">
            <button type="button" class="tab-btn active" data-tab="login" onclick="switchAuthTab('login')" style="flex: 1; padding: 0.75rem; background: rgba(212, 175, 55, 0.9); border: none; border-radius: 0.375rem; color: #1a1f2e; font-weight: 700; cursor: pointer; transition: all 0.2s ease;">
                Sign In
            </button>
            <button type="button" class="tab-btn" data-tab="register" onclick="switchAuthTab('register')" style="flex: 1; padding: 0.75rem; background: transparent; border: none; border-radius: 0.375rem; color: #94a3b8; font-weight: 700; cursor: pointer; transition: all 0.2s ease;">
                Create Account
            </button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="auth-form active" style="display: block;">
            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="login-username" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Username
                </label>
                <input
                    type="text"
                    id="login-username"
                    name="username"
                    placeholder="Enter your username"
                    required
                    autocomplete="username"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="login-password" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Password
                </label>
                <input
                    type="password"
                    id="login-password"
                    name="password"
                    placeholder="Enter your password"
                    required
                    autocomplete="current-password"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
            </div>

            <div class="form-group" style="margin-bottom: 2rem; display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="remember-me" style="width: 1.25rem; height: 1.25rem; cursor: pointer;">
                <label for="remember-me" style="color: #94a3b8; font-size: 0.9rem; cursor: pointer; user-select: none;">
                    Remember me for 30 days
                </label>
            </div>

            <button
                type="submit"
                class="btn-login"
                style="width: 100%; padding: 1rem 2rem; background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%); border: none; border-radius: 0.5rem; color: #1a1f2e; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(212, 175, 55, 0.4)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(212, 175, 55, 0.3)'"
            >
                ğŸ” Sign In
            </button>
        </form>

        <!-- Registration Form -->
        <form id="register-form" class="auth-form" style="display: none;">
            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="reg-username" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Username <span style="color: #e74c3c;">*</span>
                </label>
                <input
                    type="text"
                    id="reg-username"
                    name="username"
                    placeholder="Choose a username (3-50 characters)"
                    required
                    minlength="3"
                    maxlength="50"
                    autocomplete="username"
                    oninput="this.value = this.value.toLowerCase();"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
                <small style="color: #94a3b8; font-size: 0.8rem; display: block; margin-top: 0.25rem;">Letters, numbers, dots, hyphens, underscores only (auto-converted to lowercase)</small>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="reg-name" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Full Name <span style="color: #e74c3c;">*</span>
                </label>
                <input
                    type="text"
                    id="reg-name"
                    name="name"
                    placeholder="Enter your full name"
                    required
                    autocomplete="name"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="reg-rank" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Rank <span style="color: #94a3b8; font-weight: 400;">(Optional)</span>
                </label>
                <select
                    id="reg-rank"
                    name="rank"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease; cursor: pointer;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
                    <option value="">Select rank...</option>
                    <option value="Pvt">Pvt - Private</option>
                    <option value="PFC">PFC - Private First Class</option>
                    <option value="LCpl">LCpl - Lance Corporal</option>
                    <option value="Cpl">Cpl - Corporal</option>
                    <option value="Sgt">Sgt - Sergeant</option>
                    <option value="SSgt">SSgt - Staff Sergeant</option>
                    <option value="GySgt">GySgt - Gunnery Sergeant</option>
                    <option value="MSgt">MSgt - Master Sergeant</option>
                    <option value="1stSgt">1stSgt - First Sergeant</option>
                    <option value="MGySgt">MGySgt - Master Gunnery Sergeant</option>
                    <option value="SgtMaj">SgtMaj - Sergeant Major</option>
                    <option value="2ndLt">2ndLt - Second Lieutenant</option>
                    <option value="1stLt">1stLt - First Lieutenant</option>
                    <option value="Capt">Capt - Captain</option>
                    <option value="Maj">Maj - Major</option>
                    <option value="LtCol">LtCol - Lieutenant Colonel</option>
                    <option value="Col">Col - Colonel</option>
                    <option value="BGen">BGen - Brigadier General</option>
                    <option value="MajGen">MajGen - Major General</option>
                    <option value="LtGen">LtGen - Lieutenant General</option>
                    <option value="Gen">Gen - General</option>
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label for="reg-password" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Password <span style="color: #e74c3c;">*</span>
                </label>
                <input
                    type="password"
                    id="reg-password"
                    name="password"
                    placeholder="Create a password (min 8 characters)"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
                <small style="color: #94a3b8; font-size: 0.8rem; display: block; margin-top: 0.25rem;">Must contain uppercase, lowercase, and number</small>
            </div>

            <div class="form-group" style="margin-bottom: 1rem;">
                <label for="reg-confirm-password" style="display: block; color: #e2e8f0; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                    Confirm Password <span style="color: #e74c3c;">*</span>
                </label>
                <input
                    type="password"
                    id="reg-confirm-password"
                    name="confirmPassword"
                    placeholder="Re-enter your password"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; font-size: 1rem; transition: all 0.2s ease;"
                    onfocus="this.style.borderColor='#d4af37'; this.style.background='rgba(255, 255, 255, 0.15)'"
                    onblur="this.style.borderColor='rgba(255, 255, 255, 0.2)'; this.style.background='rgba(255, 255, 255, 0.1)'"
                >
            </div>

            <div id="password-strength" style="margin-bottom: 2rem; min-height: 1.5rem;">
                <!-- Password strength indicator inserted by JS -->
            </div>

            <button
                type="submit"
                class="btn-register"
                style="width: 100%; padding: 1rem 2rem; background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%); border: none; border-radius: 0.5rem; color: #1a1f2e; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);"
                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(212, 175, 55, 0.4)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(212, 175, 55, 0.3)'"
            >
                ğŸš€ Create Account
            </button>
        </form>

        <!-- Info Section -->
        <div class="login-info" style="margin-top: 2rem; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.75rem;">
            <p style="color: #34d399; font-size: 0.875rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.25rem;">ğŸ”’</span>
                <span>Passwords are hashed with bcrypt (12 rounds) for maximum security</span>
            </p>
            <p style="color: #94a3b8; font-size: 0.875rem; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.25rem;">âœ…</span>
                <span>Your data is stored securely and used only for event management</span>
            </p>
        </div>

        <!-- Branding Footer -->
        <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="color: #94a3b8; font-size: 0.875rem; margin-bottom: 0.5rem;">POWERED BY</div>
            <div style="color: #d4af37; font-weight: 700; font-size: 1rem; cursor: pointer;" onclick="window.open('https://linktr.ee/semperadmin', '_blank')">
                SEMPER ADMIN
            </div>
        </div>
    </div>
</div>

<script>
// Tab switching functionality
function switchAuthTab(tab) {
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const tabs = document.querySelectorAll('.tab-btn');

    tabs.forEach(btn => {
        if (btn.getAttribute('data-tab') === tab) {
            btn.style.background = 'rgba(212, 175, 55, 0.9)';
            btn.style.color = '#1a1f2e';
        } else {
            btn.style.background = 'transparent';
            btn.style.color = '#94a3b8';
        }
    });

    if (tab === 'login') {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
    } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
    }
}
</script>

<!-- ============================================
     MAIN APP CONTENT
     ============================================ -->
<div class="app-content" style="display: none;">
    <div class="header">
        <div class="container">
            <div class="header-content">
                <div class="semper-branding" onclick="window.open('https://linktr.ee/semperadmin', '_blank')">
                    POWERED BY SEMPER ADMIN
                </div>
                <h1>EventCall</h1>
                <div class="tagline">Where Every Event Matters</div>
                <div class="tagline">ğŸš§ Under Construction ğŸš§</div>
                
                <!-- User Profile Button (UPDATED) -->
                <button class="user-btn" onclick="showUserMenu()" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; color: #e2e8f0; cursor: pointer; transition: all 0.2s ease;">
                    <span class="user-avatar" id="user-avatar" style="display: inline-flex; align-items: center; justify-content: center; width: 2rem; height: 2rem; background: #d4af37; color: #1a1f2e; border-radius: 50%; font-weight: 700; font-size: 0.875rem;">ğŸ‘¤</span>
                    <span class="user-name" id="user-display-name">User</span>
                </button>
            </div>
          <nav class="nav" role="navigation" aria-label="Main navigation">
              <button onclick="goToDashboard()" class="active" id="nav-dashboard" aria-label="Go to Dashboard" aria-current="page">ğŸ  Dashboard</button>
              <button onclick="showPage('create')" id="nav-create" aria-label="Create New Event">â• Create Event</button>
          </nav>
        </div>
    </div>

    <div class="container">
        <main id="main-content" role="main">
        <div id="dashboard" class="page active">
            <div class="welcome-banner">
                <div class="welcome-title">ğŸ–ï¸ Welcome to EventCall</div>
                <div class="welcome-description">
                    Professional military event management with real-time RSVP tracking. Create events instantly and share invite links for seamless coordination.
                </div>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 style="color: var(--semper-navy); font-size: 2rem; font-weight: 700;">Your Events</h2>
            </div>
            <div id="events-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading events...
                </div>
            </div>
        </div>

        <div id="create" class="page">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 style="color: var(--semper-navy); font-size: 2rem; font-weight: 700;">Create New Event</h2>
                <div style="font-size: 0.875rem; color: var(--semper-red); font-weight: 600;">
                    ğŸ¯ Mission Planning
                </div>
            </div>

            <!-- Event Templates Selector -->
            <div id="template-selector-container"></div>

            <form id="event-form">
                <div class="form-group">
                    <label for="event-title" class="required">Event Title</label>
                    <input type="text" id="event-title" required placeholder="e.g., Retirement Ceremony for MSgt Johnson" aria-required="true" aria-describedby="title-help">
                    <span id="title-help" class="sr-only">Enter a descriptive title for your event, at least 3 characters</span>
                </div>

                <div class="form-group">
                    <label for="event-date" class="required">Date</label>
                    <input type="date" id="event-date" required aria-required="true" aria-describedby="date-help">
                    <span id="date-help" class="sr-only">Select the date when your event will take place</span>
                </div>

                <div class="form-group">
                    <label for="event-time" class="required">Time</label>
                    <input type="time" id="event-time" required aria-required="true" aria-describedby="time-help">
                    <span id="time-help" class="sr-only">Select the time when your event will start</span>
                </div>

                <div class="form-group">
                    <label for="event-location">Location</label>
                    <input type="text" id="event-location" placeholder="e.g., Base Chapel, Building 123" aria-describedby="location-help">
                    <span id="location-help" class="sr-only">Enter the location where the event will be held</span>
                </div>

                <div class="form-group">
                    <label for="event-description">Description</label>
                    <textarea id="event-description" placeholder="Additional details about the event..." aria-describedby="description-help"></textarea>
                    <span id="description-help" class="sr-only">Provide additional details about the event</span>
                </div>

                <div class="form-group">
                    <label for="cover-input">Cover Image (Optional)</label>
                    <div class="image-upload" id="cover-upload" role="button" tabindex="0" aria-label="Upload cover image by clicking or dragging a file" aria-describedby="cover-help">
                        <p>Click or drag to upload cover image</p>
                        <input type="file" id="cover-input" accept="image/*" style="display: none;" aria-label="Choose cover image file">
                    </div>
                    <span id="cover-help" class="sr-only">Upload a cover image for your event. Maximum size 5MB. Accepted formats: JPEG, PNG, GIF, WebP</span>
                    <img id="cover-preview" class="image-preview hidden" alt="Event cover image preview">
                    <input type="hidden" id="cover-image-url" value="">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ask-reason"> Ask guests why they're attending
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="allow-guests"> Allow guests to bring additional people
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="requires-meal-choice"> Event requires meal/dietary choices
                    </label>
                </div>

                <!-- Event Details Section -->
                <div id="event-details-section" style="display: none; margin: 1.5rem 0; padding: 1rem; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 0.5rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem; color: #1e40af;">
                        ğŸ“ Event Details
                    </div>
                    <div id="event-details-container"></div>
                </div>

                <!-- Seating Chart Configuration Section -->
                <div class="seating-config-section">
                    <h3>ğŸª‘ Seating Chart (Optional)</h3>

                    <div class="seating-config-toggle">
                        <input type="checkbox" id="enable-seating">
                        <label for="enable-seating">Enable seating chart for this event</label>
                    </div>

                    <div id="seating-config-fields" class="hidden">
                        <div class="seating-config-fields">
                            <div class="seating-config-field">
                                <label for="number-of-tables">Number of Tables</label>
                                <input type="number" id="number-of-tables" min="1" max="100" value="10">
                                <small>Total number of tables at the venue</small>
                            </div>

                            <div class="seating-config-field">
                                <label for="seats-per-table">Seats per Table</label>
                                <input type="number" id="seats-per-table" min="2" max="20" value="8">
                                <small>Average capacity per table</small>
                            </div>
                        </div>

                        <div class="seating-config-info">
                            â„¹ï¸ Total Capacity: <strong><span id="total-seating-capacity">80</span> seats</strong>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Custom Questions (Optional)</label>
                    <div id="custom-questions-container"></div>
                    <button type="button" class="btn" onclick="addCustomQuestion()">â• Add Question</button>
                </div>

                <!-- IMPORTANT: type="submit" with no onclick handler -->
                <button type="submit" class="btn" aria-label="Deploy event and create invitation">ğŸš€ Deploy Event</button>
            </form>
        </div>

        <div id="manage" class="page">
            <div id="event-details"></div>
        </div>

        <div id="invite" class="page">
            <div id="invite-content"></div>
        </div>
        </main>
    </div>

    <div class="footer">
        <div class="footer-content">
            <div class="footer-logo">SEMPER ADMIN</div>
            
            <div class="footer-links">
                <a href="https://linktr.ee/semperadmin" target="_blank" class="footer-link">
                    ğŸ”— Official Linktree
                </a>
                <a href="mailto:contact@semperadmin.com" class="footer-link">
                    ğŸ“§ Contact Us
                </a>
                <a href="#" onclick="showPage('create')" class="footer-link">
                    ğŸš€ Create Event
                </a>
            </div>
            
            <div class="footer-description">
                Professional event management solutions for military personnel and organizations. 
                Streamlining communications and logistics for ceremonies, promotions, retirements, and special events.
            </div>
            
            <div class="footer-copyright">
                Â© 2025 Semper Admin. All rights reserved. | EventCall - Professional Military Event Management
            </div>
        </div>
    </div>
</div>

<!-- Profile Dropdown - Updated for Manager Flow -->
<div id="profile-dropdown" style="display: none; position: absolute; top: 3.5rem; right: 1rem; width: 300px; background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000; border: 2px solid var(--semper-gold);">
  <!-- Header Section -->
  <div style="padding: 1rem; background: linear-gradient(135deg, var(--semper-navy), var(--primary-color)); color: white; border-radius: 1rem 1rem 0 0;">
    <div style="font-weight: 700; font-size: 1rem; margin-bottom: 0.25rem;">ğŸ‘¤ Event Manager</div>
    <div style="font-size: 0.85rem; opacity: 0.9;" id="dropdown-email">User</div>
    <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">Personal Dashboard</div>
  </div>
  
  <!-- Status Section -->
  <div style="padding: 1rem; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
    <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
      <span id="token-status-icon">ğŸ”—</span>
      <span id="token-status-text" style="color: #10b981; font-weight: 600;">GitHub Connected</span>
    </div>
    <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
      Events synced to cloud â€¢ Secure token in memory
    </div>
  </div>
  
  <!-- Actions Section -->
  <div style="padding: 0.75rem;">
    <!-- Change Token Button -->
    <div style="padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--semper-navy); font-weight: 500; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent;" 
         onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#bae6fd'"
         onmouseout="this.style.background=''; this.style.borderColor='transparent'">
      <span style="font-size: 1.1rem;">ğŸ”‘</span> 
      <span>Change Token</span>
    </div>
    
    <!-- Logout Button -->
    <div style="padding: 0.75rem 1rem; border-radius: 0.5rem; color: #dc2626; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent;" 
         id="logout-btn"
         onmouseover="this.style.background='#fef2f2'; this.style.borderColor='#fecaca'"
         onmouseout="this.style.background=''; this.style.borderColor='transparent'">
      <span style="font-size: 1.1rem;">ğŸšª</span> 
      <span>Logout</span>
    </div>
  </div>
  
  <!-- Footer Section -->
  <div style="padding: 0.5rem; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; border-radius: 0 0 1rem 1rem;">
    <button id="cancel-dropdown" style="background: none; border: none; color: #6b7280; font-size: 0.875rem; cursor: pointer; padding: 0.25rem 0.5rem; border-radius: 0.25rem; transition: all 0.2s ease;"
            onmouseover="this.style.color='#374151'; this.style.background='#f3f4f6'"
            onmouseout="this.style.color='#6b7280'; this.style.background=''">
      Cancel
    </button>
  </div>
</div>

<!-- Service Worker Registration -->
<script src="js/service-worker-registration.js"></script>

<!-- EARLY FUNCTIONS FIRST -->
<script src="js/error-handler.js"></script>
<!-- ============================================
     SCRIPTS (UPDATED ORDER)
     ============================================ -->
<!-- Temporarily minimizing scripts to isolate a parse error -->
<script src="js/config.js?v=20251104-2"></script>
<!-- Isolation mode: other scripts temporarily disabled for debugging
<script src="js/rate-limiter.js"></script>
<script src="js/utils.js"></script>
<!-- Re-enabling remaining modules for isolation testing -->
<script src="js/validation.js"></script>
<script src="js/manager-auth.js"></script>
<script src="js/recurring-events.js"></script>
<script src="js/login-ui.js"></script>
<script src="js/main.js"></script>
<script src="js/calendar-export.js"></script>
<script src="js/csv-import.js"></script>
<script src="js/event-templates.js"></script>
<script src="js/military-data.js"></script>
<script src="js/qr-checkin.js"></script>
<script src="js/seating-chart.js"></script>
<script src="js/service-worker-registration.js"></script>
<!-- Removed duplicate imports: keeping versioned user-auth and single backend-api later -->
<script src="js/utils.js"></script>
<script src="js/csrf.js"></script>
<script src="js/github-api.js"></script>
<script src="js/rsvp-handler.js"></script>
<script src="js/ui-components.js"></script>
<script src="js/event-manager.js"></script>
<script src="js/manager-system.js"></script>
<script src="js/early-functions.js"></script>
<script src="js/rate-limiter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/validator@13.9.0/validator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.11.6/bundle/libphonenumber-js.min.js"></script>
<script src="js/validation.js"></script>
-->

<!-- AUTHENTICATION - REPLACED manager-auth.js with user-auth.js -->
<script src="js/user-auth.js?v=20251104-2"></script>

<!-- GitHub and Event Management -->
<!--
<script src="js/github-api.js"></script>
<script src="js/calendar-export.js"></script>
<script src="js/military-data.js"></script>
<script src="js/event-templates.js"></script>
<script src="js/csv-import.js"></script>
<script src="js/recurring-events.js"></script>
<script src="js/seating-chart.js"></script>
<script src="js/event-manager.js"></script>
<script src="js/manager-system.js"></script>
<script src="js/ui-components.js"></script>
<script src="js/rsvp-handler.js"></script>
<script src="js/early-functions.js"></script>
-->

</body>
</html>
 
