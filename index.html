<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventCall - Where Every Event Matters</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/invite.css">
    <link rel="stylesheet" href="styles/responsive.css">
</head>
<body>
<!-- Updated Login Page HTML - Replace the #login-page div in your index.html -->
<div id="login-page" style="display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; inset: 0; background: linear-gradient(135deg, #0f1419 0%, #1a1a2e 50%, #c41e3a 100%); color: white; z-index: 2000; padding: 2rem; text-align: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
  <div style="max-width: 500px; width: 100%;">
    <!-- Logo/Header -->
    <div style="margin-bottom: 2rem;">
      <h1 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
        🎖️ EventCall
      </h1>
      <p style="font-size: 1.1rem; opacity: 0.9; font-style: italic; color: #ffd700;">
        Where Every Event Matters
      </p>
      <p style="font-size: 0.875rem; opacity: 0.8; color: #ffd700; margin-top: 0.5rem;">
        🚧 Under Construction 🚧
      </p>
    </div>

    <!-- Setup Form -->
    <div style="background: rgba(255, 255, 255, 0.1); padding: 2rem; border-radius: 1rem; backdrop-filter: blur(10px); border: 2px solid rgba(255, 215, 0, 0.3);">
      <h2 style="margin-bottom: 1rem; font-size: 1.5rem;">🔐 Manager Setup</h2>
      <p style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 2rem;">
        Enter your credentials to access your event management dashboard.
      </p>
      
      <!-- Email Input -->
      <div style="margin-bottom: 1.5rem; text-align: left;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #ffd700;">
          📧 Manager Email
        </label>
        <input 
          type="email" 
          id="login-email" 
          placeholder="john@company.com"
          autofocus
          style="width: 100%; padding: 0.75rem; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 0.5rem; font-size: 1rem; background: rgba(255, 255, 255, 0.1); color: white; backdrop-filter: blur(5px);" 
          onkeydown="if(event.key==='Enter') document.getElementById('github-token').focus()" />
      </div>

      <!-- GitHub Token Input with Copy Button -->
      <div style="margin-bottom: 1.5rem; text-align: left;">
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #ffd700;">
          🔑 GitHub Access Token
        </label>
        <div style="position: relative; display: flex; gap: 0.5rem; align-items: center;">
          <div style="flex: 1; position: relative;">
            <input 
              type="password" 
              id="github-token" 
              placeholder="Click Copy Token for instant setup"
              style="width: 100%; padding: 0.75rem; padding-right: 3rem; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 0.5rem; font-size: 1rem; background: rgba(255, 255, 255, 0.1); color: white; backdrop-filter: blur(5px);" 
              onkeydown="if(event.key==='Enter') userAuth.setupManager()" />
            <button 
              type="button"
              onclick="toggleTokenVisibility()"
              style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #ffd700; cursor: pointer; font-size: 1.2rem;"
              title="Show/Hide Token">
              👁️
            </button>
          </div>
          <button 
            type="button"
            onclick="copyDefaultToken()"
            style="padding: 0.75rem 1rem; background: linear-gradient(135deg, #ffd700, #e6c200); color: #0f1419; border: none; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;"
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 215, 0, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
            title="Copy default EventCall token">
            📋 COPY TOKEN
          </button>
        </div>
        <div style="margin-top: 0.5rem; font-size: 0.75rem; opacity: 0.8;">
          Your GitHub Personal Access Token with repo permissions
          <span style="color: #ffd700; font-weight: 600;">• Click "Copy Token" for instant setup</span>
        </div>
      </div>

      <!-- Connect Button -->
      <button 
        onclick="userAuth.setupManager()" 
        id="setup-btn"
        style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #ffd700, #e6c200); color: #0f1419; border: none; border-radius: 0.5rem; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 215, 0, 0.4)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        🔗 CONNECT & ACCESS DASHBOARD
      </button>

      <!-- Help Text -->
      <div style="margin-top: 1.5rem; font-size: 0.8rem; opacity: 0.7; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 1rem;">
        <p><strong>🚀 Quick Setup (Recommended):</strong></p>
        <p>1. Click the "📋 COPY TOKEN" button above</p>
        <p>2. Click "🔗 CONNECT & ACCESS DASHBOARD"</p>
        <p>3. Start managing your events!</p>
        
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
          <p><strong>Need your own GitHub token?</strong></p>
          <p>1. Go to GitHub.com → Settings → Developer settings → Personal access tokens</p>
          <p>2. Generate new token with 'public_repo' permissions</p>
          <p>3. Copy and paste it above</p>
        </div>
      </div>
    </div>

    <!-- Footer Info -->
    <div style="margin-top: 2rem; font-size: 0.8rem; opacity: 0.7;">
      <p>Professional military event management system</p>
      <p>Powered by <strong style="color: #ffd700;">SEMPER ADMIN</strong></p>
    </div>
  </div>
</div>

<script>
// Add the default token constant
const DEFAULT_GITHUB_TOKEN = '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';

function copyDefaultToken() {
    const tokenInput = document.getElementById('github-token');
    const copyButton = event.target;
    const originalText = copyButton.textContent;
    
    // Set the default token
    tokenInput.value = DEFAULT_GITHUB_TOKEN;
    
    // Copy to clipboard
    navigator.clipboard.writeText(DEFAULT_GITHUB_TOKEN).then(() => {
        // Show success feedback
        copyButton.innerHTML = '✅ COPIED!';
        copyButton.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        
        // Show toast notification
        if (window.showToast) {
            showToast('✅ Default token copied and auto-filled!', 'success');
        }
        
        // Reset button after 2 seconds
        setTimeout(() => {
            copyButton.textContent = originalText;
            copyButton.style.background = 'linear-gradient(135deg, #ffd700, #e6c200)';
        }, 2000);
        
    }).catch(() => {
        // Fallback if clipboard API fails
        tokenInput.select();
        copyButton.innerHTML = '👆 AUTO-FILLED!';
        
        if (window.showToast) {
            showToast('✅ Token auto-filled! Click Connect to continue.', 'success');
        }
        
        setTimeout(() => {
            copyButton.textContent = originalText;
        }, 2000);
    });
}

function toggleTokenVisibility() {
    const tokenInput = document.getElementById('github-token');
    const toggleBtn = tokenInput?.nextElementSibling;
    
    if (tokenInput.type === 'password') {
        tokenInput.type = 'text';
        toggleBtn.textContent = '🙈';
        toggleBtn.title = 'Hide Token';
    } else {
        tokenInput.type = 'password';
        toggleBtn.textContent = '👁️';
        toggleBtn.title = 'Show Token';
    }
}
</script>

      <!-- Connect Button -->
      <button 
        onclick="userAuth.setupManager()" 
        id="setup-btn"
        style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #ffd700, #e6c200); color: #1e3a8a; border: none; border-radius: 0.5rem; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 215, 0, 0.4)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        🔗 Connect & Access Dashboard
      </button>

      <!-- Help Text -->
      <div style="margin-top: 1.5rem; font-size: 0.8rem; opacity: 0.7; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 1rem;">
        <p><strong>Need a GitHub token?</strong></p>
        <p>1. Go to GitHub.com → Settings → Developer settings → Personal access tokens</p>
        <p>2. Generate new token with 'repo' permissions</p>
        <p>3. Copy and paste it above</p>
      </div>
    </div>

    <!-- Footer Info -->
    <div style="margin-top: 2rem; font-size: 0.8rem; opacity: 0.7;">
      <p>Professional military event management system</p>
      <p>Powered by <strong style="color: #ffd700;">SEMPER ADMIN</strong></p>
    </div>
  </div>
</div>

<!-- Main App Content -->
<div class="app-content" style="display: none;">
    <div class="header">
        <div class="container">
            <div class="header-content">
                <div class="semper-branding" onclick="window.open('https://linktr.ee/semperadmin', '_blank')">
                    POWERED BY SEMPER ADMIN
                </div>
                <h1>EventCall</h1>
                <div class="tagline">Where Every Event Matters</div>
                <div class="tagline">🚧 Under Construction 🚧</div>
                
                <!-- User Profile Button -->
                <div class="user-profile-btn" onclick="userAuth.showUserProfile()" title="User Profile & Logout">
                    <span class="user-icon">👤</span>
                    <span class="user-email" id="user-email-display">User</span>
                </div>
            </div>
          <div class="nav">
              <button onclick="goToDashboard()" class="active" id="nav-dashboard">🏠 Dashboard</button>
              <button onclick="showPage('create')" id="nav-create">➕ Create Event</button>
          </div>
        </div>
    </div>

    <div class="container">
        <div id="dashboard" class="page active">
            <div class="welcome-banner">
                <div class="welcome-title">🎖️ Welcome to EventCall</div>
                <div class="welcome-description">
                    Professional military event management with real-time RSVP tracking. Create events instantly and share invite links for seamless coordination.
                </div>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 style="color: var(--semper-navy); font-size: 2rem; font-weight: 700;">Your Events</h2>
            </div>
            <div id="events-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading events...
                </div>
            </div>
        </div>

        <div id="create" class="page">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                <h2 style="color: var(--semper-navy); font-size: 2rem; font-weight: 700;">Create New Event</h2>
                <div style="font-size: 0.875rem; color: var(--semper-red); font-weight: 600;">
                    🎯 Mission Planning
                </div>
            </div>
            
            <!-- IMPORTANT: No action attribute, no method attribute -->
            <form id="event-form">
                <div class="form-group">
                    <label for="event-title">Event Title</label>
                    <input type="text" id="event-title" required placeholder="e.g., Retirement Ceremony for MSgt Johnson">
                </div>

                <div class="form-group">
                    <label for="event-date">Date</label>
                    <input type="date" id="event-date" required>
                </div>

                <div class="form-group">
                    <label for="event-time">Time</label>
                    <input type="time" id="event-time" required>
                </div>

                <div class="form-group">
                    <label for="event-location">Location</label>
                    <input type="text" id="event-location" placeholder="e.g., Base Chapel, Building 123">
                </div>

                <div class="form-group">
                    <label for="event-description">Description</label>
                    <textarea id="event-description" placeholder="Additional details about the event..."></textarea>
                </div>

                <div class="form-group">
                    <label>Cover Image (Optional)</label>
                    <div class="image-upload" id="cover-upload">
                        <p>Click or drag to upload cover image</p>
                        <input type="file" id="cover-input" accept="image/*" style="display: none;">
                    </div>
                    <img id="cover-preview" class="image-preview hidden">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ask-reason"> Ask guests why they're attending
                    </label>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="allow-guests"> Allow guests to bring additional people
                    </label>
                </div>

                <div class="form-group">
                    <label>Custom Questions (Optional)</label>
                    <div id="custom-questions-container">
                        <div class="custom-question-item">
                            <input type="text" placeholder="Enter your question..." class="custom-question-input">
                            <button type="button" class="btn btn-danger" onclick="removeCustomQuestion(this)">🗑️</button>
                        </div>
                    </div>
                    <button type="button" class="btn" onclick="addCustomQuestion()">➕ Add Question</button>
                </div>

                <!-- IMPORTANT: type="submit" with no onclick handler -->
                <button type="submit" class="btn">🚀 Deploy Event</button>
            </form>
        </div>

        <div id="manage" class="page">
            <div id="event-details"></div>
        </div>

        <div id="invite" class="page">
            <div id="invite-content"></div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-content">
            <div class="footer-logo">SEMPER ADMIN</div>
            
            <div class="footer-links">
                <a href="https://linktr.ee/semperadmin" target="_blank" class="footer-link">
                    🔗 Official Linktree
                </a>
                <a href="mailto:contact@semperadmin.com" class="footer-link">
                    📧 Contact Us
                </a>
                <a href="#" onclick="showPage('create')" class="footer-link">
                    🚀 Create Event
                </a>
            </div>
            
            <div class="footer-description">
                Professional event management solutions for military personnel and organizations. 
                Streamlining communications and logistics for ceremonies, promotions, retirements, and special events.
            </div>
            
            <div class="footer-copyright">
                © 2025 Semper Admin. All rights reserved. | EventCall - Professional Military Event Management
            </div>
        </div>
    </div>
</div>

<!-- Profile Dropdown - Updated for Manager Flow -->
<div id="profile-dropdown" style="display: none; position: absolute; top: 3.5rem; right: 1rem; width: 300px; background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000; border: 2px solid var(--semper-gold);">
  <!-- Header Section -->
  <div style="padding: 1rem; background: linear-gradient(135deg, var(--semper-navy), var(--primary-color)); color: white; border-radius: 1rem 1rem 0 0;">
    <div style="font-weight: 700; font-size: 1rem; margin-bottom: 0.25rem;">👤 Event Manager</div>
    <div style="font-size: 0.85rem; opacity: 0.9;" id="dropdown-email">User</div>
    <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">Personal Dashboard</div>
  </div>
  
  <!-- Status Section -->
  <div style="padding: 1rem; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
    <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
      <span id="token-status-icon">🔗</span>
      <span id="token-status-text" style="color: #10b981; font-weight: 600;">GitHub Connected</span>
    </div>
    <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">
      Events synced to cloud • Secure token in memory
    </div>
  </div>
  
  <!-- Actions Section -->
  <div style="padding: 0.75rem;">
    <!-- Change Token Button -->
    <div style="padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--semper-navy); font-weight: 500; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent;" 
         onclick="userAuth.promptForTokenOverride()"
         onmouseover="this.style.background='#f0f9ff'; this.style.borderColor='#bae6fd'"
         onmouseout="this.style.background=''; this.style.borderColor='transparent'">
      <span style="font-size: 1.1rem;">🔑</span> 
      <span>Change Token</span>
    </div>
    
    <!-- Logout Button -->
    <div style="padding: 0.75rem 1rem; border-radius: 0.5rem; color: #dc2626; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent;" 
         id="logout-btn"
         onmouseover="this.style.background='#fef2f2'; this.style.borderColor='#fecaca'"
         onmouseout="this.style.background=''; this.style.borderColor='transparent'">
      <span style="font-size: 1.1rem;">🚪</span> 
      <span>Logout</span>
    </div>
  </div>
  
  <!-- Footer Section -->
  <div style="padding: 0.5rem; text-align: center; background: #f9fafb; border-top: 1px solid #e5e7eb; border-radius: 0 0 1rem 1rem;">
    <button id="cancel-dropdown" style="background: none; border: none; color: #6b7280; font-size: 0.875rem; cursor: pointer; padding: 0.25rem 0.5rem; border-radius: 0.25rem; transition: all 0.2s ease;"
            onmouseover="this.style.color='#374151'; this.style.background='#f3f4f6'"
            onmouseout="this.style.color='#6b7280'; this.style.background=''">
      Cancel
    </button>
  </div>
</div>

<!-- EARLY FUNCTIONS FIRST -->
<script src="js/early-functions.js"></script>

<!-- CONFIG -->
<script src="js/config.js"></script>

<!-- USER AUTH -->
<script src="js/user-auth.js"></script>

<!-- CORE SYSTEMS -->
<script src="js/github-api.js"></script>
<script src="js/event-manager.js"></script>
<script src="js/rsvp-handler.js"></script>

<!-- UI & MANAGER -->
<script src="js/ui-components.js"></script>
<script src="js/manager-system.js"></script>

<!-- MAIN -->
<script src="js/main.js"></script>

<!-- Token Visibility Toggle Function -->
<script>
function toggleTokenVisibility() {
  const tokenInput = document.getElementById('github-token');
  const toggleBtn = tokenInput?.nextElementSibling;
  
  if (tokenInput.type === 'password') {
    tokenInput.type = 'text';
    toggleBtn.textContent = '🙈';
    toggleBtn.title = 'Hide Token';
  } else {
    tokenInput.type = 'password';
    toggleBtn.textContent = '👁️';
    toggleBtn.title = 'Show Token';
  }
}

function copyDefaultToken() {
    const tokenInput = document.getElementById('github-token');
    const copyButton = event.target;
    const originalText = copyButton.textContent;
    
    // Set the default token
    tokenInput.value = DEFAULT_GITHUB_TOKEN;
    
    // Copy to clipboard
    navigator.clipboard.writeText(DEFAULT_GITHUB_TOKEN).then(() => {
        // Show success feedback
        copyButton.innerHTML = '✅ Copied!';
        copyButton.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        
        // Show toast notification
        if (window.showToast) {
            showToast('✅ Default token copied and auto-filled!', 'success');
        }
        
        // Reset button after 2 seconds
        setTimeout(() => {
            copyButton.textContent = originalText;
            copyButton.style.background = 'linear-gradient(135deg, #ffd700, #e6c200)';
        }, 2000);
        
    }).catch(() => {
        // Fallback if clipboard API fails
        tokenInput.select();
        copyButton.innerHTML = '👆 Auto-filled!';
        
        if (window.showToast) {
            showToast('✅ Token auto-filled! Click Connect to continue.', 'success');
        }
        
        setTimeout(() => {
            copyButton.textContent = originalText;
        }, 2000);
    });
}
</script>
</body>
</html>
